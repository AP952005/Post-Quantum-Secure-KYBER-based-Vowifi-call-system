# ğŸ¯ Complete Voice Call System - Visual Overview

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WiFi Network                                 â”‚
â”‚                    (192.168.x.x range)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                          â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   MACHINE A             â”‚         â”‚   MACHINE B              â”‚
      â”‚   (Receiver/Listener)   â”‚         â”‚   (Sender/Caller)        â”‚
      â”‚   192.168.1.100         â”‚         â”‚   192.168.1.105          â”‚
      â”‚                         â”‚         â”‚                          â”‚
      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
      â”‚ â”‚  Key Registry     â”‚   â”‚         â”‚ â”‚  Streamlit Sender â”‚    â”‚
      â”‚ â”‚  Server           â”‚   â”‚         â”‚ â”‚  App               â”‚    â”‚
      â”‚ â”‚  Port 5001        â”‚   â”‚         â”‚ â”‚  :8501             â”‚    â”‚
      â”‚ â”‚  0.0.0.0:5001     â”‚   â”‚         â”‚ â”‚                    â”‚    â”‚
      â”‚ â”‚                   â”‚   â”‚         â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
      â”‚ â”‚ Users:            â”‚   â”‚         â”‚ â”‚ â”‚ Voice Interface â”‚ â”‚    â”‚
      â”‚ â”‚ â””â”€ alice (PK)     â”‚   â”‚         â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚    â”‚
      â”‚ â”‚ â””â”€ bob (PK)       â”‚   â”‚         â”‚ â”‚ â”‚ â”‚ Enter: bob  â”‚ â”‚ â”‚    â”‚
      â”‚ â”‚                   â”‚   â”‚         â”‚ â”‚ â”‚ â”‚ Call: alice â”‚ â”‚ â”‚    â”‚
      â”‚ â”‚ Call Sessions:    â”‚   â”‚         â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚    â”‚
      â”‚ â”‚ â””â”€ call-id-xxx    â”‚   â”‚         â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
      â”‚ â”‚   status: active  â”‚   â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
      â”‚ â”‚   caller: bob     â”‚   â”‚         â”‚                          â”‚
      â”‚ â”‚   callee: alice   â”‚   â”‚         â”‚ Kyber Keypair:           â”‚
      â”‚ â”‚   cipher: ...     â”‚   â”‚         â”‚ â””â”€ SK (secret key)        â”‚
      â”‚ â”‚   IPs & ports     â”‚   â”‚         â”‚ â””â”€ PK (public key)        â”‚
      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚         â”‚                          â”‚
      â”‚           â–²              â”‚         â”‚                          â”‚
      â”‚           â”‚ HTTP         â”‚         â”‚      HTTP               â”‚
      â”‚           â”‚ (Port 5001)  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º Signaling            â”‚
      â”‚           â”‚ Signaling    â”‚         â”‚                          â”‚
      â”‚           â–¼              â”‚         â”‚                          â”‚
      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
      â”‚ â”‚ Streamlit         â”‚   â”‚         â”‚ â”‚ Kyber Library     â”‚    â”‚
      â”‚ â”‚ Receiver App      â”‚   â”‚         â”‚ â”‚                   â”‚    â”‚
      â”‚ â”‚ :8501             â”‚   â”‚         â”‚ â”‚ encapsulate()  â—„â”€â”€â”¤    â”‚
      â”‚ â”‚                   â”‚   â”‚         â”‚ â”‚ (Session Key)     â”‚    â”‚
      â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
      â”‚ â”‚ â”‚ Alice       â”‚   â”‚   â”‚         â”‚                          â”‚
      â”‚ â”‚ â”‚ Listening   â”‚   â”‚   â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
      â”‚ â”‚ â”‚             â”‚   â”‚   â”‚         â”‚ â”‚ Crypto Utils      â”‚    â”‚
      â”‚ â”‚ â”‚ Check Calls â”‚   â”‚   â”‚         â”‚ â”‚                   â”‚    â”‚
      â”‚ â”‚ â”‚    â–¼        â”‚   â”‚   â”‚         â”‚ â”‚ kyber_encapsulate â”‚    â”‚
      â”‚ â”‚ â”‚ [Accept]    â”‚   â”‚   â”‚         â”‚ â”‚ encrypt_audio()   â”‚    â”‚
      â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
      â”‚ â”‚                   â”‚   â”‚         â”‚                          â”‚
      â”‚ â”‚ Kyber Keypair:    â”‚   â”‚         â”‚ Audio Stream:            â”‚
      â”‚ â”‚ â”œâ”€ SK (secret key)â”‚   â”‚         â”‚ â””â”€ VoiceStream            â”‚
      â”‚ â”‚ â””â”€ PK (public)    â”‚   â”‚         â”‚   (UDP 5556)             â”‚
      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚         â”‚                          â”‚
      â”‚           â–²              â”‚         â”‚  Call Handler:           â”‚
      â”‚           â”‚              â”‚         â”‚  â””â”€ CallHandler          â”‚
      â”‚           â”‚ UDP          â”‚         â”‚    (HTTP to registry)    â”‚
      â”‚           â”‚ Port 5557    â”‚         â”‚                          â”‚
      â”‚           â”‚ (Encrypted   â”‚         â”‚ Streamlit UI:            â”‚
      â”‚           â”‚  Audio)      â”‚         â”‚ â””â”€ Receive fetch         â”‚
      â”‚           â”‚              â”‚         â”‚ â””â”€ Enter username        â”‚
      â”‚           â–¼              â”‚         â”‚ â””â”€ Start call button     â”‚
      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚         â”‚ â””â”€ Call waiting          â”‚
      â”‚ â”‚ Audio Stream      â”‚   â”‚         â”‚ â””â”€ Active call metrics   â”‚
      â”‚ â”‚ VoiceStream       â”‚   â”‚         â”‚ â””â”€ End call button       â”‚
      â”‚ â”‚ Port 5557         â”‚   â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ â”‚                   â”‚   â”‚              Audio Stream:
      â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â””â”€ VoiceStream (UDP 5556)
      â”‚ â”‚ â”‚ Mic Input       â”‚   â”‚                 Encryption: AES-256-GCM
      â”‚ â”‚ â”‚ Per-frame:      â”‚   â”‚                 Obfuscation: XOR+SHA256
      â”‚ â”‚ â”‚ 1. Capture      â”‚   â”‚                 Latency: 50-70ms
      â”‚ â”‚ â”‚ 2. Obfuscate    â”‚   â”‚                 Bitrate: 250 kbps
      â”‚ â”‚ â”‚ 3. Encrypt      â”‚   â”‚
      â”‚ â”‚ â”‚ 4. Send UDP     â”‚   â”‚
      â”‚ â”‚ â”‚                 â”‚   â”‚
      â”‚ â”‚ â”‚ Rcv from UDP:   â”‚   â”‚
      â”‚ â”‚ â”‚ 1. Receive      â”‚   â”‚
      â”‚ â”‚ â”‚ 2. Decrypt      â”‚   â”‚
      â”‚ â”‚ â”‚ 3. De-obfuscateâ”‚   â”‚
      â”‚ â”‚ â”‚ 4. Speaker out  â”‚   â”‚
      â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â”‚ â”‚                   â”‚   â”‚
      â”‚ â”‚ Encryption:       â”‚   â”‚
      â”‚ â”‚ â””â”€ AES-256-GCM    â”‚   â”‚
      â”‚ â”‚ â””â”€ Per-frame      â”‚   â”‚
      â”‚ â”‚ â””â”€ Session key    â”‚   â”‚
      â”‚ â”‚   from Kyber      â”‚   â”‚
      â”‚ â”‚                   â”‚   â”‚
      â”‚ â”‚ Obfuscation:      â”‚   â”‚
      â”‚ â”‚ â””â”€ XOR            â”‚   â”‚
      â”‚ â”‚ â””â”€ SHA256         â”‚   â”‚
      â”‚ â”‚ â””â”€ Per-frame      â”‚   â”‚
      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Call Flow Sequence Diagram

```
SENDER (Bob)              REGISTRY            RECEIVER (Alice)
                         Server                      
     â”‚                      â”‚                         â”‚
     â”œâ”€ Gen Kyber PK/SKâ”€â”€â†’  â”‚                         â”‚
     â”‚                      â”‚                   â† â”€ Gen Kyber PK/SK
     â”‚                      â”‚                         â”‚
     â”œâ”€ POST /registerâ”€â”€â”€â”€â†’ â”‚                         â”‚
     â”‚   {username: bob}    â”‚                         â”‚
     â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                   
     â”‚                      â”‚  â† POST /register      â”‚
     â”‚                      â”‚    {username: alice}   â”‚
     â”‚                      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚
     â”‚                      â”‚                         â”‚
     â”œâ”€ GET /fetch/alice   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
     â”‚  (get alice PK)      â”‚   â† alice's PK â†â”€â”€â”€â”€â”€â”€â”¤
     â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                         â”‚
     â”‚                      â”‚                         â”‚
     â”œâ”€ Encapsulate with alice's PK                  â”‚
     â”‚  Session Key + Ciphertext                     â”‚
     â”‚  (post-quantum KEM!)                          â”‚
     â”‚                      â”‚                         â”‚
     â”œâ”€ POST /call/initiate â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚   {call_id, ct, port}â”‚                         â”‚
     â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                         â”‚
     â”‚  {call_id: xxx}      â”‚ (stored in registry)   â”‚
     â”‚                      â”‚                         â”‚
     â”œâ”€ GET /call/status â”€â†’ â”‚    (polling...)        â”‚
     â”‚                      â”œâ”€ GET /pending/alice  â”€â†’â”‚
     â”‚                      â”‚                    â† â”€â”¤ [sees call]
     â”‚                      â”‚                         â”‚
     â”‚                      â”‚  â† POST /accept â”€â”€â”€â”€â”€â”¤ â”‚
     â”‚                      â”‚    {call_id, port}     â”‚ â”‚
     â”‚  â† POST /accept â”€â”€â”€â”€â”¤   â† â”€ alice IPs â”€â”€â”€â”€â†’ â”‚ â”‚
     â”‚    {alice_ip:port}   â”‚                        â”‚ â”‚
     â”‚                      â”‚                         â”‚
     â”œâ”€ Decapsulate ciphertext with PK               â”‚
     â”‚  (get shared session key)                     â”‚
     â”‚                      â”‚                    â”œâ”€ Decapsulate ct
     â”‚                      â”‚                    â”‚  (get session key)
     â”‚                      â”‚                         â”‚
     â”œâ”€ Start VoiceStream â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚  UDP: 192.168.1.105:5556    AUDIO STREAM     â”‚
     â”‚  Session Key: [encrypted]                     â”‚
     â”‚  Per-frame:                                   â”‚
     â”‚  â”œâ”€ Encrypt (AES-256-GCM)                     â”‚
     â”‚  â”œâ”€ Obfuscate (XOR + SHA256)                  â”‚
     â”‚  â””â”€ Send UDP                                  â”‚
     â”‚                      â”‚                        â”œâ”€ Start VoiceStream
     â”‚                      â”‚                        â”‚  Listen: port 5557
     â”‚                      â”‚                        â”‚
     â”‚   [Bidirectional Audio]                       â”‚
     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
     â”‚   â”‚ Frame 1, 2, 3... (encrypted + obfuscated)  â”‚
     â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚
     â”‚   â”‚ (decrypted + de-obfuscated at receiver)    â”‚
     â”‚   â”‚ Speaker plays                              â”‚
     â”‚   â”‚                                            â”‚
     â”‚   â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
     â”‚   â”‚ (encrypted + obfuscated from receiver)     â”‚
     â”‚   â”‚ Decrypted + de-obfuscated at sender)      â”‚
     â”‚   â”‚ Speaker plays                              â”‚
     â”‚   â”‚                                            â”‚
     â”‚   â”‚ â† Latency: 50-70ms (round-trip) â†’         â”‚
     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     â”‚                      â”‚                         â”‚
     â”‚  Click "End Call"    â”‚                         â”‚
     â”‚  â”œâ”€ POST /hangup  â”€â”€â†’â”‚                         â”‚
     â”‚                      â”œâ”€ POST /hangup â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚                      â”‚                    â”œâ”€ Stop VoiceStream
     â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚  Stop VoiceStream    â”‚                    â”œâ”€ Clear buffers
     â”‚  Clear buffers       â”‚                    â”‚
     â”‚                      â”‚  [Call Ended]       â”‚
     â”‚                      â”‚                         â”‚
```

---

## ğŸ”’ Encryption Pipeline (Per Audio Frame)

### Sender Side (Encryption + Obfuscation)
```
Microphone Input (1024 samples, 16-bit)
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Session Key (32 bytes)              â”‚ â—„â”€â”€â”€ From Kyber Decapsulation
    â”‚  + Frame Number                      â”‚      or Encapsulation
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Obfuscation Key = SHA256(Session Key || Frame #)
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Obfuscate:                         â”‚
    â”‚  audio_obfuscated = audio âŠ• obf_key â”‚  (~1ms)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  AES-256-GCM Encryption:            â”‚
    â”‚  â”œâ”€ Key: Session Key (256-bit)      â”‚
    â”‚  â”œâ”€ IV: Random nonce (96-bit)       â”‚  (~2-3ms)
    â”‚  â”œâ”€ Data: audio_obfuscated         â”‚
    â”‚  â”œâ”€ Auth: frame_number             â”‚
    â”‚  â””â”€ Output: Ciphertext + Auth Tag  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    UDP Packet to Receiver
    [Nonce || Ciphertext || Auth Tag]
    Size: ~2KB
    Port: 5556 (or 5557 for receiver)
```

### Receiver Side (Decryption + De-obfuscation)
```
UDP Packet Received
[Nonce || Ciphertext || Auth Tag]
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  AES-256-GCM Decryption:            â”‚
    â”‚  â”œâ”€ Key: Session Key (same key)     â”‚
    â”‚  â”œâ”€ IV: Nonce from packet           â”‚  (~2-3ms)
    â”‚  â”œâ”€ Data: Ciphertext                â”‚
    â”‚  â”œâ”€ Auth: Auth Tag (verify)         â”‚
    â”‚  â””â”€ Output: audio_obfuscated        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  De-obfuscate:                      â”‚
    â”‚  audio = audio_obf âŠ• obf_key        â”‚  (~1ms)
    â”‚  (Same obf_key = Same Frame #)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Circular Audio Buffer
         â”‚
         â–¼
    Speaker Output (1024 samples)
    Timing: ~5ms total per frame
```

**Total Latency per Frame**:
- Sender encryption: ~3ms
- Network (WiFi): ~20-30ms
- Receiver decryption: ~3ms
- Playout: ~5ms
- **TOTAL: 50-70ms** âœ… (competitive with Zoom!)

---

## ğŸ” Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECURITY LAYERS                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Layer 1: KEY EXCHANGE (Post-Quantum)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Kyber512 (NIST-Approved PQC KEM)                   â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Sender gets Receiver's public key                  â”‚    â”‚
â”‚  â”‚ Sender encapsulates (generates session key)        â”‚    â”‚
â”‚  â”‚ Ciphertext sent to Receiver through registry       â”‚    â”‚
â”‚  â”‚ Receiver decapsulates (recovers session key)       â”‚    â”‚
â”‚  â”‚ Both have same session key: quantum-safe!         â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ Kyber Stats:                                       â”‚    â”‚
â”‚  â”‚ â”œâ”€ Public Key: 800 bytes                          â”‚    â”‚
â”‚  â”‚ â”œâ”€ Secret Key: 1632 bytes                         â”‚    â”‚
â”‚  â”‚ â”œâ”€ Ciphertext: 1088 bytes                         â”‚    â”‚
â”‚  â”‚ â”œâ”€ Session Key: 32 bytes                          â”‚    â”‚
â”‚  â”‚ â””â”€ Security: 256-bit quantum-safe                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Layer 2: SYMMETRIC ENCRYPTION (Authenticated)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ AES-256-GCM (FIPS 197 + Authentication)            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ Session key (from Kyber) used per-frame            â”‚    â”‚
â”‚  â”‚ Random nonce per frame (12 bytes)                  â”‚    â”‚
â”‚  â”‚ Ciphertext protected + Authenticated               â”‚    â”‚
â”‚  â”‚ Any tampering detected immediately                 â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ AES Stats:                                         â”‚    â”‚
â”‚  â”‚ â”œâ”€ Key: 256-bit (unbreakable)                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ Mode: GCM (Galois/Counter)                     â”‚    â”‚
â”‚  â”‚ â”œâ”€ Nonce: 96-bit random per frame                 â”‚    â”‚
â”‚  â”‚ â””â”€ Auth Tag: Detects tampering                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Layer 3: IDENTITY OBFUSCATION (Speaker Unknown)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Per-Frame XOR + SHA-256                            â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚ For each frame i:                                  â”‚    â”‚
â”‚  â”‚ obfuscation_key = SHA256(session_key || frame_i)  â”‚    â”‚
â”‚  â”‚ audio_obfuscated = audio_samples âŠ• obf_key        â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ Result: Even if audio encrypted, identity hidden  â”‚    â”‚
â”‚  â”‚ Attacker hears unrecognizable noise                â”‚    â”‚
â”‚  â”‚ Only recipient can identify speaker (has SK)       â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚ Obfuscation Stats:                                 â”‚    â”‚
â”‚  â”‚ â”œâ”€ Hash: SHA-256 (one-way)                        â”‚    â”‚
â”‚  â”‚ â”œâ”€ XOR: Binary XOR (one-way with no pattern)      â”‚    â”‚
â”‚  â”‚ â”œâ”€ Per-Frame: Unique key each 64ms                â”‚    â”‚
â”‚  â”‚ â””â”€ Result: Identity completely hidden             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  THREAT COVERAGE:                                           â”‚
â”‚  âœ… Eavesdropping â†’ AES-256-GCM                           â”‚
â”‚  âœ… Identify Caller â†’ Per-frame obfuscation               â”‚
â”‚  âœ… Key Compromise â†’ Ephemeral per-call                   â”‚
â”‚  âœ… Future Quantum â†’ Kyber512 PQC                         â”‚
â”‚  âœ… Tampering â†’ GCM authentication                        â”‚
â”‚  âš ï¸  Metadata Visible â†’ Call timing/duration seen         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ Deployment Scenarios

### Scenario 1: Local WiFi (Office/Home)
```
Internet
   â”‚
   â”œâ”€â”€â”€ Router/WiFi 5GHz/2.4GHz â”€â”€â”€â”
   â”‚                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Laptop A         â”‚      â”‚ Laptop B         â”‚
â”‚ 192.168.1.100    â”‚      â”‚ 192.168.1.105    â”‚
â”‚                  â”‚      â”‚                  â”‚
â”‚ â”œâ”€ Registry      â”‚      â”‚ â”œâ”€ Sender App    â”‚
â”‚ â”œâ”€ Receiver App  â”‚      â”‚ â””â”€ Call Bobâ†’Alice â”‚
â”‚ â””â”€ Listen        â”‚      â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 2: Cloud Registry (Anywhere)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cloud Server                   â”‚
â”‚      (AWS/Azure/GCP)                â”‚
â”‚      public.example.com:5001        â”‚
â”‚                                     â”‚
â”‚      Registry Server                â”‚
â”‚      â”œâ”€ Store users                 â”‚
â”‚      â”œâ”€ Coordinate calls            â”‚
â”‚      â””â”€ Ephemeral call state        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ HTTPS (optional future)
        â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alice     â”‚         â”‚ Bob        â”‚   â”‚ Carol       â”‚
â”‚ (Caller)  â”‚         â”‚ (Caller)   â”‚   â”‚ (Receiver)  â”‚
â”‚           â”‚         â”‚            â”‚   â”‚             â”‚
â”‚ Initiate  â”‚         â”‚ Initiate   â”‚   â”‚ Listen      â”‚
â”‚ Call      â”‚         â”‚ Call       â”‚   â”‚ For calls   â”‚
â”‚ (UDP P2P) â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (UDP P2P)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Component Interaction Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COMPLETE SYSTEM                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  USER INTERFACE LAYER (Streamlit)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Sender App        â”‚    Receiver App      â”‚         â”‚
â”‚  â”‚  (sender_app.py)    â”‚  (receiver_app.py)   â”‚         â”‚
â”‚  â”‚                     â”‚                      â”‚         â”‚
â”‚  â”‚ â”œâ”€ File transfer    â”‚  â”œâ”€ File reception  â”‚         â”‚
â”‚  â”‚ â”œâ”€ Voice calls      â”‚  â”œâ”€ Voice calls     â”‚         â”‚
â”‚  â”‚ â”œâ”€ Crypto controls  â”‚  â””â”€ Call listening  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                          â”‚                    â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                        â”‚                                â”‚
â”‚  PROTOCOL LAYER (HTTP + UDP)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Call Handler        Crypto Utils          â”‚        â”‚
â”‚  â”‚ (call_handler.py)  (crypto_utils.py)      â”‚        â”‚
â”‚  â”‚                                            â”‚        â”‚
â”‚  â”‚ â”œâ”€ HTTP POST/GET    â”œâ”€ Kyber512          â”‚        â”‚
â”‚  â”‚ â”œâ”€ Registry API     â”œâ”€ AES-256-GCM       â”‚        â”‚
â”‚  â”‚ â”œâ”€ Call polling     â””â”€ XOR obfuscation   â”‚        â”‚
â”‚  â”‚ â””â”€ State mgmt                             â”‚        â”‚
â”‚  â”‚                                            â”‚        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
â”‚  â”‚      Audio Stream                         â”‚        â”‚
â”‚  â”‚    (audio_stream.py)                      â”‚        â”‚
â”‚  â”‚                                            â”‚        â”‚
â”‚  â”‚  â”œâ”€ 4 Daemon Threads                     â”‚        â”‚
â”‚  â”‚  â”‚  â”œâ”€ Record (Microphone)               â”‚        â”‚
â”‚  â”‚  â”‚  â”œâ”€ Send (UDP)                        â”‚        â”‚
â”‚  â”‚  â”‚  â”œâ”€ Receive (UDP)                     â”‚        â”‚
â”‚  â”‚  â”‚  â””â”€ Play (Speaker)                    â”‚        â”‚
â”‚  â”‚  â”‚                                        â”‚        â”‚
â”‚  â”‚  â”œâ”€ Per-Frame Processing                â”‚        â”‚
â”‚  â”‚  â”‚  â”œâ”€ Encrypt (AES-256)                â”‚        â”‚
â”‚  â”‚  â”‚  â”œâ”€ Obfuscate (XOR+SHA256)           â”‚        â”‚
â”‚  â”‚  â”‚  â”œâ”€ Decrypt                          â”‚        â”‚
â”‚  â”‚  â”‚  â””â”€ De-obfuscate                     â”‚        â”‚
â”‚  â”‚  â”‚                                        â”‚        â”‚
â”‚  â”‚  â””â”€ Thread-Safe Buffers                 â”‚        â”‚
â”‚  â”‚     â”œâ”€ Circular audio queue              â”‚        â”‚
â”‚  â”‚     â””â”€ Synchronized timing               â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                      â”‚
â”‚  NETWORK LAYER (HTTP REST + UDP P2P)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Registry Server   â”‚  Direct Audio       â”‚     â”‚
â”‚  â”‚  (key_registry_    â”‚  Streaming          â”‚     â”‚
â”‚  â”‚   server.py)       â”‚  (UDP 5556/5557)    â”‚     â”‚
â”‚  â”‚  Port 5001         â”‚                     â”‚     â”‚
â”‚  â”‚  0.0.0.0           â”‚  â”œâ”€ Encrypted       â”‚     â”‚
â”‚  â”‚                    â”‚  â”œâ”€ Obfuscated      â”‚     â”‚
â”‚  â”‚  Endpoints:        â”‚  â”œâ”€ Point-to-Point â”‚     â”‚
â”‚  â”‚  â”œâ”€ /register      â”‚  â”œâ”€ Full-duplex    â”‚     â”‚
â”‚  â”‚  â”œâ”€ /fetch         â”‚  â””â”€ 50-70ms latencyâ”‚     â”‚
â”‚  â”‚  â”œâ”€ /call/initiate â”‚                    â”‚     â”‚
â”‚  â”‚  â”œâ”€ /call/accept   â”‚  Server.py         â”‚     â”‚
â”‚  â”‚  â”œâ”€ /call/pending  â”‚  (Socket handling) â”‚     â”‚
â”‚  â”‚  â”œâ”€ /call/hangup   â”‚  â”œâ”€ UDP receive    â”‚     â”‚
â”‚  â”‚  â””â”€ /call/status   â”‚  â”œâ”€ UDP send       â”‚     â”‚
â”‚  â”‚                    â”‚  â””â”€ Port binding   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                      â”‚
â”‚  STORAGE LAYER                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  registry.json (User registry)            â”‚     â”‚
â”‚  â”‚  â”œâ”€ Usernames                             â”‚     â”‚
â”‚  â”‚  â”œâ”€ Kyber public keys                     â”‚     â”‚
â”‚  â”‚  â”œâ”€ Listening IP:port                     â”‚     â”‚
â”‚  â”‚  â””â”€ Registration timestamps               â”‚     â”‚
â”‚  â”‚                                            â”‚     â”‚
â”‚  â”‚  CALL_SESSIONS (In-memory)                â”‚     â”‚
â”‚  â”‚  â”œâ”€ Active calls                          â”‚     â”‚
â”‚  â”‚  â”œâ”€ Call state (ringing/active/ended)    â”‚     â”‚
â”‚  â”‚  â”œâ”€ Session key ciphertexts               â”‚     â”‚
â”‚  â”‚  â””â”€ Peer IP:port info                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Data Flow: Complete Call Example

```
ALICE (Receiver)              REGISTRY              BOB (Sender)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Start Up
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Register:           POSTâ†’  Store:
{alice, PK_alice}          alice: {PK, IP, port}


2. Bob Fetches Alice
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    â†GETâ”€  Return:
                           {alice_PK}

3. Bob Initiates Call
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    POSTâ†’  Store Call:
                           call-id-xxx {
                             caller: bob
                             callee: alice
                             CT: encapsulated_key
                             status: ringing
                           }


4. Alice Checks Calls
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    â†GETâ”€  Return:
                           [{call from bob,
                             CT, nonce}]


5. Alice Accepts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    POSTâ†’  Update:
                           call-id-xxx {
                             status: active
                             alice_ip: 192.168.1.100
                             alice_port: 5557
                           }


6. Bob Gets Status
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    â†GETâ”€  Return:
                           {bob_ip: 192.168.1.105
                            bob_port: 5556
                            alice_ip: 192.168.1.100
                            alice_port: 5557}


7. Direct Audio Streaming
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Bob Microphone             Alice Speaker
â”‚                                â”‚
â”œâ”€ Capture frame                 â”‚
â”œâ”€ Encrypt + Obfuscate           â”‚
â”œâ”€ Send UDP to 192.168.1.100:5557â”œâ”€â”€â†’
â”‚                                â”‚
â”‚                            Receive
â”‚                            Decrypt
â”‚                            De-obfuscate
â”‚                            â”œâ”€ Playout
â”‚                            â”‚
â”‚                     Alice Microphone
â”‚                            â”‚
â”‚                        â”œâ”€ Capture frame
â”‚                        â”œâ”€ Encrypt + Obfuscate
â”‚                        â”œâ”€ Send UDP to 192.168.1.105:5556
â”‚                            â”‚
Bob Speaker        â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”œâ”€ Receive
â”œâ”€ Decrypt
â”œâ”€ De-obfuscate
â””â”€ Playout


8. Call Ends
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    POSTâ†’  Update:
                           call-id-xxx {
                             status: ended
                             ended_at: timestamp
                           }

[After ~5 min, cleanup call from memory]
```

---

## âœ… SUCCESS INDICATORS

### When Everything Works:
```
Browser 1 (Alice - Receiver):
  â””â”€ Streamlit App :8501
     â”œâ”€ âœ… Kyber keypair generated
     â”œâ”€ âœ… Registered as "alice"
     â”œâ”€ âœ… Public key in registry
     â””â”€ âœ… Listening for calls

Browser 2 (Bob - Sender):
  â””â”€ Streamlit App :8501
     â”œâ”€ âœ… Fetched alice's public key
     â”œâ”€ âœ… Username entered as "bob"
     â”œâ”€ âœ… Start call button clicked
     â””â”€ âœ… Session key encapsulated

Browser 1 (Alice - Receiver):
  â””â”€ Streamlit App :8501
     â”œâ”€ âœ… Incoming call detected
     â”œâ”€ âœ… Accept button clicked
     â”œâ”€ âœ… Session key decapsulated
     â””â”€ âœ… VoiceStream started

Both Browsers:
  â”œâ”€ âœ… Show: "ğŸŸ¢ ACTIVE VOICE CALL"
  â”œâ”€ âœ… Show: Frame counters (increasing)
  â”œâ”€ âœ… Show: Queue size (stable 2-10)
  â”œâ”€ âœ… Hear: Other person speaking
  â”œâ”€ âœ… Hear: Natural audio (50-70ms latency)
  â””â”€ âœ… Audio: Encrypted + Obfuscated

Test Suite:
  â””â”€ python test_voice_call.py
     â”œâ”€ âœ… TEST 1: Registry connectivity
     â”œâ”€ âœ… TEST 2: User registration
     â”œâ”€ âœ… TEST 3: Call workflow
     â”œâ”€ âœ… TEST 4: Audio configuration
     â””â”€ âœ… TEST 5: Cryptography
```

---

## ğŸ‰ YOU HAVE A COMPLETE VOICE CALL SYSTEM!

**Next Steps**:
1. Read: `00_START_HERE_VOICE.md`
2. Run: `python test_voice_call.py`
3. Make your first call!

